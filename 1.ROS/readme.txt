Istruzioni per esplorazione con Stage
1- invocare mappa_da_xml.py che prende un xml del dataset e ne crea una mappa.
2- una volta salvata la mappa, vanno tagliati gli spazi al di fuori dei suoi muri. In pratica bisogna rimuovere il contorno bianco in eccesso, io lo faccio con il programma Pinta (Image -> AutoCrop). Questo passaggio è importante per il giusto istanziamento del robot.
Inoltre vanno aperte le porte, in quanto nell'xml sono erroneamente descritte come larghe 1 pixel, quindi nell'immagine risultante sono praticamente invisibili. O si modifica il file xml in modo da allargarle, o semplicemente si colora di bianco la parte di muro in cui dovrebbe esserci una porta (basta guardare l'immagine corrispondente contenuta in datasetsistemati/immagini, che però è invertita verticalmente).
3- invocare crea_world.py, che prende il path della mappa appena creata, dell'xml corrispondente e crea una file .world che verrà poi aperto da Stage. Questo file descrive l'ambiente che si vuole esplorare con Stage, e viene salvato nella cartella world_per_stage. Viene creato prendendo il file default.world e modificandolo. Al suo interno viene anche settata la posizione in cui dev'essere istanziato il robot, calcolata come baricentro della stanza che nell'xml è descritta come ENTRANCE.
4- da terminale chiamare "roscore"    
5- da un'altra finestra del terminale chiamare "roslaunch stage_rviz.launch world:=nome_file_world"
Ovviamente al posto di nome_file_world ci va il nome del file world creato al punto 3 (solo il nome, il path è già scritto alla linea 31 di stage_rviz). 
6- Si apre rviz. Sulla sinistra si possono aggiungere (add) gli elementi visualizzati (displays). Aggiungere laserScan (mostra gli ostacoli percepiti) ed impostarne il topic a /base_scan, e aumentarne la size se poco visibile. Aggiungere anche gridCells ed impostarne il topic a /Navigator/plan in modo da mostrare il percorso pianificato dal robot durante l'esplorazione. 
7- Come spiegato in http://wiki.ros.org/nav2d/Tutorials/MultiMapper, l'esplorazione autonoma non può essere eseguita subito, prima deve essere eseguita una breve esplorazione sicura con una rotazione di 360°. Se hai un joystick, basta premere il tasto 4, altrimenti basta aprire un altra finestra di terminale e chiamare "rosservice call /StartMapping 3". Dopodichè per iniziare l'esplorazione autonoma basta premere il tasto 1, oppure chiamare "rosservice call /StartExploration 2".
8- Mentre avviene l'esplorazione, in un'altra finestra del terminale si può chiamare "python salva_mappa.py nome_mappa" dove nome_mappa è il nome che vuoi dare alla mappa salvata. Lo script salva ogni 5 secondi (modificabile a piacere) l'immagine di mappa esplorata che si vede in Rviz. Vengono salvate nella cartella mappe_salvate.
